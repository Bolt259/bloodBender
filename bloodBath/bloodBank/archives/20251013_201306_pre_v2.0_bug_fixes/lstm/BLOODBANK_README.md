# bloodBath bloodBank v2.0 Data Architecture

This directory implements the unified bloodBank v2.0 data architecture for comprehensive pump data management and ML training.

## Architecture Overview

### 📁 raw/ - Raw Data Organization
**Purpose**: Raw pump data organized by type and serial number
- `cgm/{serial}/`: CGM readings for each pump
- `basal/{serial}/`: Basal rate data for each pump  
- `bolus/{serial}/`: Bolus/meal data for each pump
- `lstm/`: Raw LSTM processing workspace
- `metadata/`: Sync metadata and validation reports

### 📁 merged/ - LSTM-Ready Sequences
**Purpose**: Processed sequences ready for ML training
- `train/` (70%): Training dataset with chronological split
- `validate/` (15%): Validation dataset for hyperparameter tuning
- `test/` (15%): Test dataset for final model evaluation
- `full/`: Complete processed sequences before splitting

### 📁 archives/ - Legacy and Logs
**Purpose**: Legacy data preservation and operational tracking
- `legacy/`: Migrated sweetBlood data for compatibility
- `logs/`: System logs, sync reports, and error tracking

### 📁 models/ - ML Models
**Purpose**: Trained models and training artifacts
- Trained LSTM models for glucose prediction
- Model checkpoints and configurations
- Training metrics and evaluation reports

## Data Flow

```
Raw Pump Data → Validation → LSTM Processing → Train/Val/Test Splits → Model Training
     ↓              ↓             ↓                    ↓                    ↓
  raw/{type}    metadata/     merged/full/        merged/{split}/       models/
```

## Schema v2.0 Features

✅ **Unified Data Architecture**: Single source of truth for all pump data
✅ **Type-Based Organization**: Separate directories for CGM, basal, bolus data  
✅ **Serial-Based Partitioning**: Each pump's data isolated for parallel processing
✅ **ML-Ready Splits**: Chronological train/validate/test splits maintained
✅ **Comprehensive Metadata**: Full tracking of sync status, validation results
✅ **Legacy Compatibility**: Seamless migration from sweetBlood structure
✅ **Scalable Design**: Support for multiple pumps and years of data

## Usage

Initialize and sync data:
```bash
# Full resynchronization (4+ years)
python full_bloodbank_resync.py

# Incremental updates
python -m bloodBath sync --pump-serial 881235 --update-mode

# Validation and reports
python -m bloodBath validate --pump-serial all
```

Access processed data:
```python
from bloodBath.core.config import DATA_PATHS

# Training data
train_dir = DATA_PATHS['merged']['train']

# Raw CGM data for pump 881235
cgm_dir = DATA_PATHS['raw']['cgm'] / '881235'

# Metadata and reports
metadata_dir = DATA_PATHS['raw']['metadata']
```

## Configuration

bloodBank root configured in `bloodBath/core/config.py`:
```python
BLOODBANK_ROOT = Path(__file__).parent.parent / "bloodBank"
```

Override with environment variable:
```bash
export BLOODBATH_BLOODBANK_ROOT=/path/to/custom/bloodbank
```

---
*Generated by bloodBath v2.0 - Schema v2.0*
